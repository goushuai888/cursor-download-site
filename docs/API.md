# API æ–‡æ¡£

## ğŸ“– æ¦‚è¿°

æœ¬é¡¹ç›®ç°åœ¨ä½¿ç”¨è‡ªæ‰˜ç®¡çš„ API æ¥ç®¡ç† Cursor ç‰ˆæœ¬æ•°æ®ï¼Œä¸å†ä¾èµ–å¤–éƒ¨ APIã€‚

## ğŸ”§ API æ¶æ„

### 1. æ•°æ®å­˜å‚¨
- **ä½ç½®**: `/data/versions.json`
- **æ ¼å¼**: JSON æ•°ç»„
- **ç»“æ„**:
```json
[
  {
    "version": "2.0.64",
    "buildId": "25412918da7e74b2686b25d62da1f01cfcd27683",
    "downloadChannel": ["aws"],
    "date": "2025-11-06"
  }
]
```

### 2. API ç«¯ç‚¹

#### è·å–ç‰ˆæœ¬åˆ—è¡¨
```
GET /api/versions
```

**å“åº”ç¤ºä¾‹**:
```json
[
  {
    "version": "2.0.64",
    "buildId": "25412918da7e74b2686b25d62da1f01cfcd27683",
    "downloadChannel": ["aws"],
    "date": "2025-11-06"
  },
  ...
]
```

**ç‰¹æ€§**:
- âœ… è‡ªåŠ¨ç¼“å­˜ï¼ˆ5åˆ†é’Ÿï¼‰
- âœ… æ”¯æŒ stale-while-revalidate
- âœ… æŒ‰ç‰ˆæœ¬å·é™åºæ’åº

#### åŒæ­¥ç‰ˆæœ¬æ•°æ®
```
POST /api/versions/sync
```

**åŠŸèƒ½**: ä»å¤–éƒ¨æºåŒæ­¥æœ€æ–°ç‰ˆæœ¬æ•°æ®åˆ°æœ¬åœ°

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "æˆåŠŸåŒæ­¥ 100 ä¸ªç‰ˆæœ¬",
  "count": 100
}
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. åˆå§‹åŒ–æ•°æ®

é¦–æ¬¡éƒ¨ç½²æ—¶ï¼Œè¿è¡ŒåŒæ­¥å‘½ä»¤æ¥è·å–æœ€æ–°ç‰ˆæœ¬æ•°æ®ï¼š

```bash
curl -X POST http://localhost:3000/api/versions/sync
```

æˆ–è€…åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š
```
http://localhost:3000/api/versions/sync
```

### 2. æ‰‹åŠ¨æ›´æ–°æ•°æ®

ä½ å¯ä»¥ç›´æ¥ç¼–è¾‘ `/data/versions.json` æ–‡ä»¶æ¥æ·»åŠ æˆ–ä¿®æ”¹ç‰ˆæœ¬ä¿¡æ¯ã€‚

### 3. å®šæœŸåŒæ­¥ï¼ˆå¯é€‰ï¼‰

ä½ å¯ä»¥è®¾ç½®å®šæ—¶ä»»åŠ¡æ¥å®šæœŸåŒæ­¥ç‰ˆæœ¬æ•°æ®ï¼š

**ä½¿ç”¨ cron (Linux/Mac)**:
```bash
# æ¯å¤©å‡Œæ™¨2ç‚¹åŒæ­¥
0 2 * * * curl -X POST http://localhost:3000/api/versions/sync
```

**ä½¿ç”¨ GitHub Actions**:
```yaml
name: Sync Versions
on:
  schedule:
    - cron: '0 2 * * *'  # æ¯å¤©å‡Œæ™¨2ç‚¹
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Sync versions
        run: curl -X POST https://your-domain.com/api/versions/sync
```

## ğŸ“ æ•°æ®å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| `version` | string | ç‰ˆæœ¬å· | "2.0.64" |
| `buildId` | string | æ„å»º ID | "25412918..." |
| `downloadChannel` | string[] | ä¸‹è½½æ¸ é“ | ["aws", "official"] |
| `date` | string | å‘å¸ƒæ—¥æœŸ (YYYY-MM-DD) | "2025-11-06" |

## ğŸ”„ ä¸‹è½½æ¸ é“ç±»å‹

- `official` - å®˜æ–¹æ¸ é“
- `todesktop` - Todesk æ¸ é“  
- `aws` - AWS æ¸ é“
- `awsNightly` - AWS æ¯å¤œç‰ˆæ¸ é“

## ğŸ›¡ï¸ ä¼˜åŠ¿

ç›¸æ¯”ä½¿ç”¨å¤–éƒ¨ APIï¼š

1. âœ… **å®Œå…¨æ§åˆ¶**: ä½ æ‹¥æœ‰æ•°æ®çš„å®Œå…¨æ§åˆ¶æƒ
2. âœ… **æ€§èƒ½æ›´å¥½**: æœ¬åœ°æ•°æ®è®¿é—®æ›´å¿«
3. âœ… **æ— ä¾èµ–**: ä¸ä¾èµ–å¤–éƒ¨æœåŠ¡çš„å¯ç”¨æ€§
4. âœ… **å¯å®šåˆ¶**: å¯ä»¥è½»æ¾æ·»åŠ æˆ–ä¿®æ”¹ç‰ˆæœ¬ä¿¡æ¯
5. âœ… **ç¦»çº¿æ”¯æŒ**: å³ä½¿å¤–éƒ¨ API ä¸å¯ç”¨ä¹Ÿèƒ½æ­£å¸¸å·¥ä½œ

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šæ— æ³•è·å–ç‰ˆæœ¬æ•°æ®

**è§£å†³æ–¹æ³•**:
1. æ£€æŸ¥ `/data/versions.json` æ–‡ä»¶æ˜¯å¦å­˜åœ¨
2. è¿è¡ŒåŒæ­¥å‘½ä»¤ï¼š`POST /api/versions/sync`
3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

### é—®é¢˜ï¼šç‰ˆæœ¬æ•°æ®è¿‡æ—¶

**è§£å†³æ–¹æ³•**:
1. è¿è¡ŒåŒæ­¥å‘½ä»¤æ›´æ–°æ•°æ®ï¼š`POST /api/versions/sync`
2. æˆ–æ‰‹åŠ¨ç¼–è¾‘ `/data/versions.json` æ–‡ä»¶

## ğŸ“š ç›¸å…³æ–‡ä»¶

- `/data/versions.json` - ç‰ˆæœ¬æ•°æ®æ–‡ä»¶
- `/app/api/versions/route.ts` - ç‰ˆæœ¬ API ç«¯ç‚¹
- `/app/api/versions/sync/route.ts` - åŒæ­¥ API ç«¯ç‚¹
- `/lib/versions.ts` - ç‰ˆæœ¬å¤„ç†é€»è¾‘

